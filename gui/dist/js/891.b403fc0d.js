"use strict";(self["webpackChunkchengshe_homework"]=self["webpackChunkchengshe_homework"]||[]).push([[891],{116:function(e,t,s){var a=s(6518),n=s(2652),i=s(9306),o=s(8551),l=s(1767);a({target:"Iterator",proto:!0,real:!0},{find:function(e){o(this),i(e);var t=l(this),s=0;return n(t,(function(t,a){if(e(t,s++))return a(t)}),{IS_RECORD:!0,INTERRUPTED:!0}).result}})},9891:function(e,t,s){s.r(t),s.d(t,{default:function(){return le}});var a=s(641);function n(e,t,s,n,i,o){const l=(0,a.g2)("YanxxDialog");return(0,a.uX)(),(0,a.Wv)(l,{style:{flex:"1",height:"100%"}})}var i=s(33),o=s(3751);const l={class:"chat-layout"},r={ref:"messagesContainer",class:"messages"},c={key:0,class:"message-content"},d={class:"timestamp"},u={key:1,class:"message-content"},g=["onClick"],m={key:1,class:"loading-dots"},v={key:2},h={class:"timestamp"},p={key:3,class:"continuation-bar"},y={key:4,class:"continuation-bar"},k={key:5,class:"continuation-bar"},f={key:0,class:"image-preview-area"},w={class:"image-preview-header"},C={class:"image-preview-content"},L=["src","alt"],I={class:"image-overlay"},S={class:"image-filename"},b={class:"image-preview-modal-header"},E={class:"image-preview-modal-title"},P={class:"image-preview-modal-content"},x=["src","alt"],R=["disabled"],D={class:"input-buttons"},T=["disabled"],K=["disabled"];function X(e,t,s,n,X,_){const A=(0,a.g2)("HistoryPanel");return(0,a.uX)(),(0,a.CE)("div",l,[(0,a.bF)(A,{messages:n.messages,"current-session-id":n.currentSessionId,onSessionSelected:n.loadSession,onSessionCreated:n.createSession,onSessionDeleted:n.handleSessionDeleted,onHistoryCleared:n.handleHistoryCleared,onToggleCollapse:n.handleHistoryToggle},null,8,["messages","current-session-id","onSessionSelected","onSessionCreated","onSessionDeleted","onHistoryCleared","onToggleCollapse"]),(0,a.Lk)("div",{class:"chat-container",style:(0,i.Tr)({width:n.containerWidth,height:n.containerHeight})},[(0,a.Lk)("div",r,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(n.messages,((e,s)=>((0,a.uX)(),(0,a.CE)("div",{key:s,class:(0,i.C4)(["message",e.sender])},["user"===e.sender?((0,a.uX)(),(0,a.CE)("div",c,[t[13]||(t[13]=(0,a.Lk)("span",{class:"username"},"我",-1)),(0,a.eW)(" "+(0,i.v_)(e.content)+" ",1),(0,a.Lk)("span",d,(0,i.v_)(n.formatTime(e.timestamp)),1)])):((0,a.uX)(),(0,a.CE)("div",u,[e.loading?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("button",{key:0,onClick:t=>n.playVoice(e),class:"voice-play-btn"},t[14]||(t[14]=[(0,a.Lk)("i",{class:"fas fa-volume-up"},null,-1)]),8,g)),t[18]||(t[18]=(0,a.Lk)("span",{class:"username"},"严小希",-1)),e.loading?((0,a.uX)(),(0,a.CE)("span",m,"思考中")):((0,a.uX)(),(0,a.CE)("span",v,(0,i.v_)(e.content),1)),(0,a.Lk)("span",h,(0,i.v_)(n.formatTime(e.timestamp)),1),!e.loading&&e.showContinuation?((0,a.uX)(),(0,a.CE)("div",p,[t[15]||(t[15]=(0,a.Lk)("div",{class:"divider"},null,-1)),(0,a.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>n.gotoContinuation&&n.gotoContinuation(...e)),class:"continuation-btn"},"点击此处让小希来帮你续写 ->")])):(0,a.Q3)("",!0),!e.loading&&e.showPolishment?((0,a.uX)(),(0,a.CE)("div",y,[t[16]||(t[16]=(0,a.Lk)("div",{class:"divider"},null,-1)),(0,a.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>n.gotoPolishment&&n.gotoPolishment(...e)),class:"continuation-btn"},"点击此处让小希来帮你润色 ->")])):(0,a.Q3)("",!0),!e.loading&&e.showExtraction?((0,a.uX)(),(0,a.CE)("div",k,[t[17]||(t[17]=(0,a.Lk)("div",{class:"divider"},null,-1)),(0,a.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>n.gotoExtraction&&n.gotoExtraction(...e)),class:"continuation-btn"},"点击此处让小希来帮你摘抄 ->")])):(0,a.Q3)("",!0)]))],2)))),128))],512),n.selectedImage?((0,a.uX)(),(0,a.CE)("div",f,[(0,a.Lk)("div",w,[t[20]||(t[20]=(0,a.Lk)("span",{class:"image-preview-title"},"已选择图片",-1)),(0,a.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>n.removeImage&&n.removeImage(...e)),class:"remove-image-btn",title:"移除图片"},t[19]||(t[19]=[(0,a.Lk)("i",{class:"fas fa-times"},null,-1)]))]),(0,a.Lk)("div",C,[(0,a.Lk)("div",{onClick:t[4]||(t[4]=(...e)=>n.showImagePreview&&n.showImagePreview(...e)),class:"image-thumbnail-container"},[(0,a.Lk)("img",{src:`data:${n.selectedImage.type};base64,${n.selectedImage.data}`,alt:n.selectedImage.name,class:"image-thumbnail"},null,8,L),(0,a.Lk)("div",I,[t[21]||(t[21]=(0,a.Lk)("i",{class:"fas fa-eye"},null,-1)),(0,a.Lk)("span",S,(0,i.v_)(n.selectedImage.name),1)])])])])):(0,a.Q3)("",!0),n.showPreview?((0,a.uX)(),(0,a.CE)("div",{key:1,onClick:t[7]||(t[7]=(...e)=>n.hideImagePreview&&n.hideImagePreview(...e)),class:"image-preview-overlay"},[(0,a.Lk)("div",{class:"image-preview-modal",onClick:t[6]||(t[6]=(0,o.D$)((()=>{}),["stop"]))},[(0,a.Lk)("div",b,[(0,a.Lk)("span",E,(0,i.v_)(n.selectedImage?.name),1),(0,a.Lk)("button",{onClick:t[5]||(t[5]=(...e)=>n.hideImagePreview&&n.hideImagePreview(...e)),class:"close-preview-btn"},t[22]||(t[22]=[(0,a.Lk)("i",{class:"fas fa-times"},null,-1)]))]),(0,a.Lk)("div",P,[n.selectedImage?((0,a.uX)(),(0,a.CE)("img",{key:0,src:`data:${n.selectedImage.type};base64,${n.selectedImage.data}`,alt:n.selectedImage.name,class:"image-preview-full"},null,8,x)):(0,a.Q3)("",!0)])])])):(0,a.Q3)("",!0),(0,a.Lk)("div",{class:"input-area",style:(0,i.Tr)({width:n.inputAreaWidth})},[(0,a.bo)((0,a.Lk)("textarea",{"onUpdate:modelValue":t[8]||(t[8]=e=>n.userInput=e),placeholder:"输入你的问题...",onKeydown:t[9]||(t[9]=(0,o.jR)((0,o.D$)(((...e)=>n.sendMessage&&n.sendMessage(...e)),["exact","prevent"]),["enter"])),disabled:n.isLoading,rows:"2"},null,40,R),[[o.Jo,n.userInput]]),(0,a.Lk)("div",D,[(0,a.Lk)("button",{onClick:t[10]||(t[10]=(...e)=>n.triggerImageUpload&&n.triggerImageUpload(...e)),disabled:n.isLoading,class:"image-upload-btn",title:"上传图片进行OCR识别"},t[23]||(t[23]=[(0,a.Lk)("i",{class:"fas fa-image"},null,-1)]),8,T),(0,a.Lk)("input",{ref:"imageInput",type:"file",accept:"image/*",onChange:t[11]||(t[11]=(...e)=>n.handleImageUpload&&n.handleImageUpload(...e)),style:{display:"none"}},null,544),(0,a.Lk)("button",{onClick:t[12]||(t[12]=(...e)=>n.sendMessage&&n.sendMessage(...e)),disabled:n.isLoading||!n.userInput.trim()},(0,i.v_)(n.isLoading?"发送中...":"发送"),9,K)])],4)],4)])}s(4114);var _=s(953),A=s(5220),O=s(3903);const H={class:"history-header"},U={class:"history-controls"},$={key:0,class:"history-list"},N={key:0,class:"empty-history"},M={key:1,class:"history-items"},W=["onClick"],J={class:"session-header"},Q={class:"session-title"},j={class:"session-time"},q={class:"session-preview"},B={class:"preview-text"},F={class:"session-actions"},V=["onClick"],Y={key:1,class:"new-chat-section"};function z(e,t,s,n,l,r){return(0,a.uX)(),(0,a.CE)("div",{class:(0,i.C4)(["history-panel",{collapsed:n.isCollapsed}])},[(0,a.Lk)("div",H,[t[4]||(t[4]=(0,a.Lk)("div",{class:"history-title"},[(0,a.Lk)("i",{class:"fas fa-history"}),(0,a.Lk)("span",null,"对话历史")],-1)),(0,a.Lk)("div",U,[(0,a.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>n.clearHistory&&n.clearHistory(...e)),class:"clear-btn",title:"清空历史记录"},t[3]||(t[3]=[(0,a.Lk)("i",{class:"fas fa-trash"},null,-1)])),(0,a.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>n.toggleCollapse&&n.toggleCollapse(...e)),class:"collapse-btn",title:"收起/展开"},[(0,a.Lk)("i",{class:(0,i.C4)(n.isCollapsed?"fas fa-chevron-right":"fas fa-chevron-left")},null,2)])])]),n.isCollapsed?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("div",$,[0===n.historyList.length?((0,a.uX)(),(0,a.CE)("div",N,t[5]||(t[5]=[(0,a.Lk)("i",{class:"fas fa-comments"},null,-1),(0,a.Lk)("p",null,"暂无对话记录",-1),(0,a.Lk)("span",null,"开始和严小希对话吧！",-1)]))):((0,a.uX)(),(0,a.CE)("div",M,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(n.historyList,((e,l)=>((0,a.uX)(),(0,a.CE)("div",{key:e.id,class:(0,i.C4)(["history-item",{active:s.currentSessionId===e.id}]),onClick:t=>n.selectSession(e)},[(0,a.Lk)("div",J,[(0,a.Lk)("div",Q,[t[6]||(t[6]=(0,a.Lk)("i",{class:"fas fa-comment-dots"},null,-1)),(0,a.Lk)("span",null,(0,i.v_)(e.title||"对话"+(l+1)),1)]),(0,a.Lk)("div",j,(0,i.v_)(n.formatDate(e.lastTime)),1)]),(0,a.Lk)("div",q,[(0,a.Lk)("span",B,(0,i.v_)(e.preview),1)]),(0,a.Lk)("div",F,[(0,a.Lk)("button",{onClick:(0,o.D$)((t=>n.deleteSession(e.id)),["stop"]),class:"delete-session-btn",title:"删除此对话"},t[7]||(t[7]=[(0,a.Lk)("i",{class:"fas fa-times"},null,-1)]),8,V)])],10,W)))),128))]))])),n.isCollapsed?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("div",Y,[(0,a.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>n.createNewSession&&n.createNewSession(...e)),class:"new-chat-btn"},t[8]||(t[8]=[(0,a.Lk)("i",{class:"fas fa-plus"},null,-1),(0,a.Lk)("span",null,"新建对话",-1)]))]))],2)}s(8111),s(2489),s(116);var G={name:"HistoryPanel",props:{messages:{type:Array,default:()=>[]},currentSessionId:{type:String,default:null}},emits:["session-selected","session-created","session-deleted","history-cleared","toggle-collapse"],setup(e,{emit:t}){const s=(0,_.KR)(!1),n=(0,_.KR)([]),i=()=>{try{const e=localStorage.getItem("yanxx_chat_history");e&&(n.value=JSON.parse(e))}catch(e){console.error("加载历史记录失败:",e),n.value=[]}},o=()=>{try{localStorage.setItem("yanxx_chat_history",JSON.stringify(n.value))}catch(e){console.error("保存历史记录失败:",e)}},l=()=>{const e={id:Date.now().toString(),title:"新对话",preview:"开始新的对话...",messages:[],lastTime:(new Date).toISOString(),createdAt:(new Date).toISOString()};n.value.unshift(e),o(),t("session-created",e)},r=e=>{t("session-selected",e)},c=e=>{if(confirm("确定要删除这个对话吗？")){const s=n.value.findIndex((t=>t.id===e));s>-1&&(n.value.splice(s,1),o(),t("session-deleted",e))}},d=()=>{confirm("确定要清空所有对话历史吗？此操作不可恢复！")&&(n.value=[],o(),t("history-cleared"))},u=()=>{s.value=!s.value,t("toggle-collapse",s.value)},g=e=>{const t=new Date(e),s=new Date,a=s-t;if(a<864e5)return t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});if(a<1728e5)return"昨天";if(a<6048e5){const e=["周日","周一","周二","周三","周四","周五","周六"];return e[t.getDay()]}return t.toLocaleDateString()},m=()=>{if(!e.currentSessionId||0===e.messages.length)return;const t=n.value.find((t=>t.id===e.currentSessionId));if(t){t.messages=[...e.messages],t.lastTime=(new Date).toISOString();const s=e.messages.filter((e=>"user"===e.sender)).pop();if(s&&(t.preview=s.content.length>30?s.content.substring(0,30)+"...":s.content),e.messages.length>=2){const s=e.messages.find((e=>"user"===e.sender));s&&(t.title=s.content.length>20?s.content.substring(0,20)+"...":s.content)}const a=n.value.findIndex((t=>t.id===e.currentSessionId));if(a>0){const e=n.value.splice(a,1)[0];n.value.unshift(e)}o()}};return(0,a.wB)((()=>e.messages),m,{deep:!0}),i(),{isCollapsed:s,historyList:n,createNewSession:l,selectSession:r,deleteSession:c,clearHistory:d,toggleCollapse:u,formatDate:g}}},Z=s(6262);const ee=(0,Z.A)(G,[["render",z],["__scopeId","data-v-109a81cf"]]);var te=ee,se={components:{HistoryPanel:te},props:{width:{type:String,default:"100%"},height:{type:String,default:"100%"}},setup(e){const t=(0,A.rd)(),s=(0,O.J)(),n=(0,_.KR)({ModelName:s.settings.textModel.name,apiKey:s.settings.textModel.apiKey,apiUrl:s.settings.textModel.apiUrl,ModelTemperature:s.settings.textModel.params.temperature}),i=(0,_.Kh)([]),o=(0,_.KR)(""),l=(0,_.KR)(!1),r=(0,_.KR)(null),c=(0,_.KR)(null),d=(0,_.KR)(e.width),u=(0,_.KR)(e.height),g=(0,_.KR)(!1),m=(0,_.KR)(null),v=(0,_.KR)(null),h=(0,_.KR)(null),p=(0,_.KR)(!1);(0,a.wB)([()=>e.width,()=>e.height],(()=>{d.value=e.width,u.value=e.height}));const y=()=>{(0,a.dY)((()=>{r.value&&(r.value.scrollTop=r.value.scrollHeight)}))},k=e=>{h.value=e.id,i.length=0,y()},f=e=>{h.value=e.id,i.length=0,e.messages&&e.messages.length>0&&i.push(...e.messages),y()},w=e=>{h.value===e&&(i.length=0,h.value=null,L())},C=()=>{i.length=0,h.value=null,L()},L=()=>{const e={id:Date.now().toString(),title:"新对话",preview:"开始新的对话...",messages:[],lastTime:(new Date).toISOString(),createdAt:(new Date).toISOString()};h.value=e.id},I=()=>{t.push("/AIContinuation")},S=()=>{t.push("/AIPolishment")},b=()=>{t.push("/AITextExtracts")},E=e=>{const t=new Date(e);return t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},P=async function*(e){if(!e.ok){const t=await e.json();throw new Error(t.error||`请求失败: ${e.status}`)}const t=e.body.getReader(),s=new TextDecoder("utf-8");let a="";while(1){const{value:e,done:n}=await t.read();if(n)break;a+=s.decode(e,{stream:!0});const i=a.split("\n");a=i.pop()||"";for(const t of i){const e=t.trim();if(!e.startsWith("data:"))continue;const s=e.substring(5).trim();if("[DONE]"!==s){if(s.includes("error"))try{const e=JSON.parse(s);throw new Error(e.error||"未知错误")}catch{throw new Error(s)}yield{type:"content",data:s}}else yield{type:"done"}}}},x=()=>{const e=n.value.apiKey;return e?"string"!==typeof e||""===e.trim()?{valid:!1,message:"API Key格式不正确，请检查输入"}:e.length<10?{valid:!1,message:"API Key长度过短，可能无效"}:{valid:!0}:{valid:!1,message:"API Key未设置，请先配置API密钥"}},R=async()=>{if(!o.value.trim()||l.value)return;h.value||L();const e=o.value.trim();o.value="",i.push({sender:"user",content:e,timestamp:new Date});const t={sender:"ai",content:"",loading:!0,timestamp:new Date,showContinuation:!1,showPolishment:!1,showExtraction:!1};i.push(t),c.value=t,y(),l.value=!0;const s=x();if(!s.valid)return l.value=!1,c.value.content=s.message,void(c.value.loading=!1);const a=i.slice(0,-2);try{let s;t.loading=!1,s=m.value?{config:n.value,content:a,ContentRequest:e,image:m.value}:{config:n.value,content:a,ContentRequest:e};const i=await fetch("http://localhost:5000/api/dialog/classify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!i.ok)throw new Error(`分类接口请求失败: ${i.status}`);const o=await i.json();console.log("分类结果:",o),t.showContinuation=o.TextContinuation||!1,t.showPolishment=o.TextPolishment||!1,t.showExtraction=o.Extraction||!1}catch(d){console.error("分类接口调用失败:",d),t.showContinuation=!1,t.showPolishment=!1,t.showExtraction=!1}const r={config:n.value,title:"用户对话",content:a,ContentRequest:e,image:m.value};try{let s,i;t.loading=!1,await new Promise((e=>setTimeout(e,0))),m.value?(s="/api/dialog/multimodal",i=r):(s="/api/dialog",i={config:n.value,title:"用户对话",content:a,ContentRequest:e});const o=await fetch(`http://localhost:5000${s}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});for await(const e of P(o)){if(!c.value)break;switch(e.type){case"content":try{const t=JSON.parse(e.data);if(t.choices?.[0]?.delta?.content){const e=t.choices[0].delta.content;c.value.content+=e}else c.value.content+=e.data}catch(u){c.value.content+=e.data}y();break;case"done":c.value.loading=!1;break}}}catch(v){console.error("对话错误:",v),c.value&&(c.value.content=`请求失败: ${v.message}`,c.value.loading=!1)}finally{l.value=!1,c.value=null,m.value=null,g.value=!1,y()}};(0,a.sV)((()=>{L(),y()})),(0,a.wB)(i,y,{deep:!0});const D=(0,_.KR)(null),T=async e=>{D.value&&(D.value.pause(),D.value=null);try{const t=await fetch("http://localhost:5000/api/AIread",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e.content,apiKey:n.value.apiKey})});if(!t.ok)throw new Error(`语音API请求失败: ${t.status}`);const s=await t.blob(),a=URL.createObjectURL(s),i=new Audio(a);D.value=i,i.play(),i.onended=()=>{D.value=null,URL.revokeObjectURL(a)}}catch(t){console.error("语音播放错误:",t),alert(`语音播放失败: ${t.message}`)}},K=()=>{v.value.click()},X=async e=>{const t=e.target.files[0];if(t)if(t.type.startsWith("image/"))if(t.size>5242880)alert("图片大小不能超过5MB");else try{const e=await H(t);m.value={data:e,type:t.type,name:t.name};const s=`[已选择图片: ${t.name}]`;o.value.trim()?o.value+="\n"+s:o.value=s}catch(s){console.error("图片处理错误:",s),alert(`图片处理失败: ${s.message}`)}finally{v.value&&(v.value.value="")}else alert("请选择图片文件")},H=e=>new Promise(((t,s)=>{const a=new FileReader;a.readAsDataURL(e),a.onload=()=>{const e=a.result.split(",")[1];t(e)},a.onerror=e=>s(e)})),U=()=>{g.value=!0},$=()=>{g.value=!1},N=()=>{m.value=null,g.value=!1,o.value=o.value.replace(/\[已选择图片: .*?\]\n?/g,"").trim()},M=e=>{p.value=e},W=(0,a.EW)((()=>("undefined"!==typeof window&&window.innerWidth<=768||p.value,"100%")));return{messages:i,userInput:o,isLoading:l,messagesContainer:r,sendMessage:R,containerWidth:d,containerHeight:u,formatTime:E,gotoContinuation:I,gotoPolishment:S,gotoExtraction:b,playVoice:T,imageInput:v,triggerImageUpload:K,handleImageUpload:X,selectedImage:m,showPreview:g,showImagePreview:U,hideImagePreview:$,removeImage:N,currentSessionId:h,createSession:k,loadSession:f,handleSessionDeleted:w,handleHistoryCleared:C,handleHistoryToggle:M,inputAreaWidth:W}}};const ae=(0,Z.A)(se,[["render",X],["__scopeId","data-v-4249ad2b"]]);var ne=ae,ie={name:"App",components:{YanxxDialog:ne}};const oe=(0,Z.A)(ie,[["render",n]]);var le=oe}}]);
//# sourceMappingURL=891.b403fc0d.js.map