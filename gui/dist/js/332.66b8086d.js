"use strict";(self["webpackChunkchengshe_homework"]=self["webpackChunkchengshe_homework"]||[]).push([[332],{7588:function(e,t,n){var a=n(6518),o=n(2652),r=n(9306),l=n(8551),s=n(1767);a({target:"Iterator",proto:!0,real:!0},{forEach:function(e){l(this),r(e);var t=s(this),n=0;o(t,(function(t){e(t,n++)}),{IS_RECORD:!0})}})},9332:function(e,t,n){n.r(t),n.d(t,{default:function(){return F}});var a=n(641);function o(e,t,n,o,r,l){const s=(0,a.g2)("TextExtractContainer");return(0,a.uX)(),(0,a.Wv)(s)}n(4114),n(8111),n(2489),n(7588);var r=n(3751),l=n(33),s=n(953),c=n(4335),i=n(163),u=n(7918),d=n(3903);const m={class:"TextOCR"},p={key:0,class:"loading-overlay"},g={key:0,class:"upload-placeholder"},h=["src"],v={class:"text-editor"},f={class:"action-buttons"};var k={__name:"TextOCR",emits:["confirm","cancel"],setup(e,{emit:t}){const n=t,o=(0,s.KR)(null),l=(0,s.KR)(""),c=(0,s.KR)(""),u=(0,s.KR)(!1),d=()=>{o.value?.click()},k=e=>{e.dataTransfer.dropEffect="copy"},x=e=>{const t=e.dataTransfer.files[0];t&&y({target:{files:[t]}})},y=async e=>{const t=e.target.files[0];if(t)if(t.type.startsWith("image/"))if(t.size>5242880)i.nk.error("图片大小不能超过5MB");else try{u.value=!0,l.value=URL.createObjectURL(t);const e=new FormData;e.append("file",t);const n=await fetch("http://localhost:5000/api/TextOCR",{method:"POST",body:e}),a=await n.json();if("success"!==a.status)throw new Error(a.message||"识别失败");c.value=a.result}catch(n){i.nk.error(`OCR错误: ${n.message}`),w()}finally{u.value=!1}else i.nk.error("请选择图片文件")},b=()=>{n("confirm",c.value),C()},w=()=>{n("cancel"),C()},C=()=>{l.value="",c.value="",o.value&&(o.value.value="")};return(e,t)=>{const n=(0,a.g2)("Upload"),s=(0,a.g2)("el-icon"),i=(0,a.g2)("el-input"),C=(0,a.g2)("el-button");return(0,a.uX)(),(0,a.CE)("div",m,[u.value?((0,a.uX)(),(0,a.CE)("div",p,t[1]||(t[1]=[(0,a.Lk)("div",{class:"loader"},null,-1)]))):(0,a.Q3)("",!0),(0,a.Lk)("div",{class:"upload-area",onClick:d,onDragover:(0,r.D$)(k,["prevent"]),onDrop:(0,r.D$)(x,["prevent"])},[(0,a.Lk)("input",{ref_key:"fileInput",ref:o,type:"file",accept:"image/*",onChange:y,style:{display:"none"}},null,544),l.value?((0,a.uX)(),(0,a.CE)("img",{key:1,src:l.value,class:"preview-image"},null,8,h)):((0,a.uX)(),(0,a.CE)("div",g,[(0,a.bF)(s,{size:50},{default:(0,a.k6)((()=>[(0,a.bF)(n)])),_:1}),t[2]||(t[2]=(0,a.Lk)("div",{class:"upload-text"},"点击上传图片或拖拽到此区域",-1))]))],32),(0,a.Lk)("div",v,[(0,a.bF)(i,{modelValue:c.value,"onUpdate:modelValue":t[0]||(t[0]=e=>c.value=e),type:"textarea",rows:15,placeholder:"识别结果将显示在此处",resize:"none"},null,8,["modelValue"]),(0,a.Lk)("div",f,[(0,a.bF)(C,{type:"primary",onClick:b,disabled:!c.value},{default:(0,a.k6)((()=>t[3]||(t[3]=[(0,a.eW)(" 确认使用 ")]))),_:1},8,["disabled"]),(0,a.bF)(C,{onClick:w},{default:(0,a.k6)((()=>t[4]||(t[4]=[(0,a.eW)("取消")]))),_:1})])])])}}},x=n(6262);const y=(0,x.A)(k,[["__scopeId","data-v-30408754"]]);var b=y;const w={class:"TextExtractContainer"},C={key:0,class:"loading-overlay"},$={class:"input-section"},E={class:"button-section"},L={key:2,class:"excerpts-list"},T={class:"sentence-box"},_={class:"sentence-num"},R={class:"sentence-text"},S=["onUpdate:modelValue"];var M={__name:"TextExtracts",setup(e){const t=(0,d.J)(),n=(0,s.KR)(!1),o=(0,s.KR)(!1),m=t.settings.textModel.apiUrl,p=t.settings.textModel.apiKey,g=t.settings.textModel.params.maxTokens,h=t.settings.textModel.name,v=t.settings.textModel.params.temperature,f=(0,s.KR)(""),k=(0,s.Kh)([]),x=async()=>{if(f.value){if(k.splice(0,k.length),h&&m&&h)try{n.value=!0;const e=await c.A.post("http://localhost:5000/api/AITextExtracts",{config:{ModelName:h,apiKey:p,apiUrl:m,maxToken:g,ModelTemperature:v},text:f.value});console.log("提交结果:",e.data),e.data.new_suggestions&&k.splice(0,k.length,...e.data.new_suggestions)}catch(e){console.error("提交失败:",e),i.nk.error(e)}finally{n.value=!1}else i.nk.error("请填写完整文本大模型api信息！");B()}else i.nk.error("请输入需要摘抄的文本！")},y=async()=>{o.value=!0},M=e=>{f.value+=e,o.value=!1},X=()=>{o.value=!1},D=async()=>{if(0!==k.length)try{const{value:e}=await u.s.prompt("请选择导出格式：\n1. TXT文本文件\n2. Markdown文件\n3. Word文档（HTML格式）","选择导出格式",{confirmButtonText:"导出",cancelButtonText:"取消",inputPattern:/^[1-3]$/,inputErrorMessage:"请输入1-3之间的数字",inputValue:"1",inputPlaceholder:"请输入1-3"}),t=(0,i.nk)({message:"正在生成导出文件...",type:"info",duration:0});try{switch(e){case"1":await U();break;case"2":await O();break;case"3":await F();break;default:i.nk.error("无效的导出格式")}}finally{t.close()}}catch(e){"cancel"!==e&&(console.error("导出失败:",e),i.nk.error("导出失败："+(e.message||"未知错误")))}else i.nk.warning("没有摘抄内容可导出！")},U=async()=>{try{const e=I();await z(e,`摘抄内容_${K()}.txt`,"text/plain;charset=utf-8"),i.nk.success("TXT文件导出成功！")}catch(e){throw new Error("TXT文件导出失败："+e.message)}},O=async()=>{try{const e=V();await z(e,`摘抄内容_${K()}.md`,"text/markdown;charset=utf-8"),i.nk.success("Markdown文件导出成功！")}catch(e){throw new Error("Markdown文件导出失败："+e.message)}},F=async()=>{try{const e=W();await z(e,`摘抄内容_${K()}.html`,"text/html;charset=utf-8"),i.nk.success("Word文档导出成功！")}catch(e){throw new Error("Word文档导出失败："+e.message)}},K=()=>{const e=new Date;return`${e.getFullYear()}${String(e.getMonth()+1).padStart(2,"0")}${String(e.getDate()).padStart(2,"0")}_${String(e.getHours()).padStart(2,"0")}${String(e.getMinutes()).padStart(2,"0")}`},I=()=>{const e=(new Date).toLocaleString("zh-CN"),t=k.length,n=k.filter((e=>e.comment&&e.comment.trim())).length;let a="摘抄内容\n";return a+=`导出时间：${e}\n`,a+=`总计：${t}条摘抄\n`,a+=`有点评：${n}条\n`,a+=`${"=".repeat(50)}\n\n`,k.forEach(((e,t)=>{a+=`${t+1}. ${e.sentence}\n`,e.comment&&e.comment.trim()&&(a+=`   点评：${e.comment}\n`),a+="\n"})),a},V=()=>{const e=(new Date).toLocaleString("zh-CN"),t=k.length,n=k.filter((e=>e.comment&&e.comment.trim())).length;let a="# 摘抄内容\n\n";return a+=`**导出时间：** ${e}\n\n`,a+="**统计信息：**\n",a+=`- 总计：${t}条摘抄\n`,a+=`- 有点评：${n}条\n`,a+=`- 无点评：${t-n}条\n\n`,a+="---\n\n",k.forEach(((e,t)=>{a+=`## ${t+1}. ${e.sentence}\n\n`,e.comment&&e.comment.trim()&&(a+=`**点评：** ${e.comment}\n\n`),a+="---\n\n"})),a},W=()=>{const e=(new Date).toLocaleString("zh-CN"),t=k.length,n=k.filter((e=>e.comment&&e.comment.trim())).length;let a=`\n<!DOCTYPE html>\n<html>\n<head>\n    <meta charset="UTF-8">\n    <title>摘抄内容</title>\n    <style>\n        body { font-family: 'Microsoft YaHei', Arial, sans-serif; margin: 40px; line-height: 1.6; }\n        h1 { color: #333; border-bottom: 2px solid #2196F3; padding-bottom: 10px; }\n        h2 { color: #2196F3; margin-top: 30px; }\n        .excerpt { margin: 20px 0; padding: 15px; background: #f8f9fa; border-left: 4px solid #2196F3; }\n        .comment { margin-top: 10px; padding: 10px; background: #e3f2fd; border-radius: 4px; }\n        .timestamp { color: #666; font-size: 14px; }\n        .stats { background: #f0f8ff; padding: 15px; border-radius: 8px; margin: 20px 0; }\n        .stats ul { margin: 5px 0; padding-left: 20px; }\n    </style>\n</head>\n<body>\n    <h1>摘抄内容</h1>\n    <p class="timestamp">导出时间：${e}</p>\n    \n    <div class="stats">\n        <h3>统计信息</h3>\n        <ul>\n            <li>总计：${t}条摘抄</li>\n            <li>有点评：${n}条</li>\n            <li>无点评：${t-n}条</li>\n        </ul>\n    </div>\n    \n    <hr>\n`;return k.forEach(((e,t)=>{a+=`\n    <div class="excerpt">\n        <h2>${t+1}. ${e.sentence}</h2>\n`,e.comment&&e.comment.trim()&&(a+=`\n        <div class="comment">\n            <strong>点评：</strong>${e.comment}\n        </div>\n`),a+="    </div>"})),a+="\n</body>\n</html>",a},z=(e,t,n)=>new Promise(((a,o)=>{try{const o=new Blob([e],{type:n}),r=URL.createObjectURL(o),l=document.createElement("a");l.href=r,l.download=t,l.style.display="none",document.body.appendChild(l),l.click(),document.body.removeChild(l),setTimeout((()=>{URL.revokeObjectURL(r)}),100),a()}catch(r){o(new Error("文件下载失败："+r.message))}})),B=()=>{localStorage.setItem("excerptsData",JSON.stringify(k))};(0,a.sV)((()=>{const e=localStorage.getItem("excerptsData");if(e){const t=JSON.parse(e);k.push(...t)}}));const A=async()=>{try{await u.s.confirm("确定要清空所有摘抄内容吗？此操作不可恢复！","确认清空",{confirmButtonText:"确定清空",cancelButtonText:"取消",type:"warning",confirmButtonClass:"el-button--danger"}),f.value="",k.splice(0,k.length),B(),i.nk.success("内容已清空！")}catch(e){"cancel"!==e&&i.nk.error("清空操作失败："+e.message)}};return(e,t)=>((0,a.uX)(),(0,a.CE)("div",w,[t[2]||(t[2]=(0,a.Lk)("h1",null,"自动化摘抄",-1)),n.value?((0,a.uX)(),(0,a.CE)("div",C,t[1]||(t[1]=[(0,a.Lk)("div",{class:"loader"},null,-1)]))):(0,a.Q3)("",!0),(0,a.Lk)("div",$,[(0,a.bo)((0,a.Lk)("textarea",{"onUpdate:modelValue":t[0]||(t[0]=e=>f.value=e),placeholder:"粘贴或输入您的摘抄内容...",class:"text-input"},null,512),[[r.Jo,f.value]]),(0,a.Lk)("div",E,[(0,a.Lk)("button",{onClick:y,class:"picture-ocr-btn",title:"从图片中提取文字"},"📷 图片OCR"),(0,a.Lk)("button",{onClick:x,class:"process-btn",title:"开始处理文本摘抄"},"🚀 摘抄，启动！"),k.length?((0,a.uX)(),(0,a.CE)("button",{key:0,onClick:D,class:"export-btn",title:"导出摘抄内容到文件"},"📤 导出摘抄内容 ("+(0,l.v_)(k.length)+"条)",1)):(0,a.Q3)("",!0),k.length?((0,a.uX)(),(0,a.CE)("button",{key:1,onClick:A,class:"clear-btn",title:"清空所有摘抄内容"}," 🗑️ 清空内容 ")):(0,a.Q3)("",!0)])]),t[3]||(t[3]=(0,a.Lk)("br",null,null,-1)),o.value?((0,a.uX)(),(0,a.Wv)(b,{key:1,onConfirm:M,onCancel:X})):(0,a.Q3)("",!0),k.length?((0,a.uX)(),(0,a.CE)("div",L,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(k,((e,t)=>((0,a.uX)(),(0,a.CE)("div",{key:t,class:"excerpt-item"},[(0,a.Lk)("div",T,[(0,a.Lk)("span",_,"#"+(0,l.v_)(t+1),1),(0,a.Lk)("p",R,(0,l.v_)(e.sentence),1)]),(0,a.bo)((0,a.Lk)("textarea",{"onUpdate:modelValue":t=>e.comment=t,placeholder:"输入您的点评...",class:"comment-input",onInput:B},null,40,S),[[r.Jo,e.comment]])])))),128))])):(0,a.Q3)("",!0)]))}};const X=M;var D=X,U={name:"App",components:{TextExtractContainer:D}};const O=(0,x.A)(U,[["render",o]]);var F=O}}]);
//# sourceMappingURL=332.66b8086d.js.map